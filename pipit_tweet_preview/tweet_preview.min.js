function refresh(e){diff=calcChars(e),tweet_count.innerHTML=diff,handleStates(diff)}function calcChars(e){var t=e.length,n=e.match(urlRegex),a=0;if(virtualMaxTweetLength=maxTweetLength,n){var r=0;a=urlLength*n.length;for(i in n)r+=n[i].length;t=e.length-r+a,virtualMaxTweetLength=maxTweetLength-a+r}return t-=url_placeholder.length,t+=23,maxTweetLength-t}function handleStates(e){0>e?(overLimit=!0,tweet_count.className="pipit-tweet_warning"):e>=0&&(overLimit=!1,tweet_count.className="")}function parseTweet(){var e=twitter_desc.value;if(e+=" {URL}",twitter_tags.value){var t=parseTags(twitter_tags.value);for(i in t)e+=t[i]}if(twitter_via.value){if("@"===twitter_via.value.charAt(0))var n=" via "+twitter_via.value;else var n=" via @"+twitter_via.value;e+=n}if(refresh(e),overLimit){var a='<span class="pipit-tweet_warning">'+e.substr(virtualMaxTweetLength,e.length)+"</span>";e=e.replaceAtWith(virtualMaxTweetLength,a)}e=e.replace(/(#|@)\w+/g,function(e){return'<span class="pipit-tweet_link">'+e+"</span>"}),e=e.replace(urlRegex,function(e){return'<span class="pipit-tweet_link">'+e+"</span>"}),e=e.replace("{URL}",function(e){return'<span class="pipit-tweet_link">'+e+"</span>"}),tweet_content.innerHTML=e}function parseTags(e){if(e=e.replace(/( )/g,"")){e=e.split(",");for(i in e)"#"!==e[i].charAt(0)?e[i]=" #"+e[i]:e[i]=" "+e[i]}else e=[];return e}const maxTweetLength=280,urlLength=23,url_placeholder="{URL}",urlRegex=/(http|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/g;var overLimit=!1,diff=0,virtualMaxTweetLength=maxTweetLength,inputs=document.getElementsByTagName("input"),textareas=document.getElementsByTagName("textarea"),twitter_via=twitter_tags=twitter_desc="";for(String.prototype.endsWith||(String.prototype.endsWith=function(e,t){return t<this.length?t|=0:t=this.length,this.substr(t-e.length,e.length)===e}),String.prototype.replaceAtWith=function(e,t){return this.substr(0,e)+t+this.substr(e+t.length)},i=0;i<inputs.length;i++)inputs[i].id.endsWith("sharing_twitter_desc")&&(twitter_desc=inputs[i],twitter_desc.addEventListener("input",parseTweet),twitter_desc.addEventListener("change",parseTweet),twitter_desc.addEventListener("keydown",parseTweet)),inputs[i].id.endsWith("sharing_twitter_tags")&&(twitter_tags=inputs[i],twitter_tags.addEventListener("input",parseTweet),twitter_tags.addEventListener("change",parseTweet),twitter_tags.addEventListener("keydown",parseTweet)),inputs[i].id.endsWith("sharing_twitter_via")&&(twitter_via=inputs[i],twitter_via.addEventListener("input",parseTweet),twitter_via.addEventListener("change",parseTweet),twitter_via.addEventListener("keydown",parseTweet));for(i=0;i<textareas.length;i++)textareas[i].id.endsWith("sharing_twitter_desc")&&(twitter_desc=textareas[i],twitter_desc.addEventListener("input",parseTweet),twitter_desc.addEventListener("change",parseTweet),twitter_desc.addEventListener("keydown",parseTweet));if(twitter_desc){var tweet=document.createElement("div");tweet.id="pipit-tweet";var tweet_header=document.createElement("h4"),header_node=document.createTextNode("Tweet Preview");tweet_header.appendChild(header_node);var tweet_content=document.createElement("div");tweet_content.id="pipit-tweet_content";var tweet_count=document.createElement("div");tweet_count.id="pipit-tweet_count";var count_node=document.createTextNode(maxTweetLength);tweet_count.appendChild(count_node),twitter_desc.parentElement.appendChild(tweet),tweet.appendChild(tweet_header),tweet.appendChild(tweet_content),tweet.appendChild(tweet_count),parseTweet()}